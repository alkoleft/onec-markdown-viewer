// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
// –≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ –∏ –∏—Ö –∑–∞–≥—Ä—É–∑–∫–æ–π

import { isMarkdownFile, readFileContent, logError } from './utils.js';
import type { FileHandlerInterface } from './types.js';

/**
 * –ö–ª–∞—Å—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
 */
export class FileHandler implements FileHandlerInterface {
    private fileInput: HTMLInputElement;
    public onFileRead: (content: string) => void;
    public onError: (error: Error) => void;

    constructor(fileInput: HTMLInputElement, onFileLoad: (content: string) => void, onError: (error: Error) => void) {
        this.fileInput = fileInput;
        this.onFileRead = onFileLoad;
        this.onError = onError;
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ input
     * @param event - –°–æ–±—ã—Ç–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è input
     */
    async handleFileLoad(event: Event): Promise<void> {
        const target = event.target as HTMLInputElement;
        const file = target.files?.[0];
        if (!file) return;

        try {
            const content = await readFileContent(file);
            this.onFileRead(content);
        } catch (error) {
            logError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞', error as Error);
            this.onError(new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ' + (error as Error).message));
        }
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
     * @param event - –°–æ–±—ã—Ç–∏–µ drop
     */
    async handleDrop(event: DragEvent): Promise<void> {
        event.preventDefault();
        const files = event.dataTransfer?.files;
        
        if (files && files.length > 0) {
            const file = files[0];
            if (isMarkdownFile(file)) {
                try {
                    const content = await readFileContent(file);
                    this.onFileRead(content);
                } catch (error) {
                    logError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞', error as Error);
                    this.onError(new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ' + (error as Error).message));
                }
            } else {
                this.onError(new Error('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ markdown —Ñ–∞–π–ª (.md, .markdown, .txt)'));
            }
        }
    }

    /**
     * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞–¥ –æ–±–ª–∞—Å—Ç—å—é
     * @param event - –°–æ–±—ã—Ç–∏–µ dragover
     */
    handleDragOver(event: DragEvent): void {
        event.preventDefault();
    }

    /**
     * –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
     */
    openFileDialog(): void {
        this.fileInput.click();
    }

    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
     */
    init(): void {
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ
    }
}

/**
 * –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∏–º–µ—Ä markdown –∫–æ–Ω—Ç–µ–Ω—Ç–∞
 * @returns –ü—Ä–∏–º–µ—Ä markdown –∫–æ–Ω—Ç–µ–Ω—Ç–∞
 */
export function getExampleMarkdown(): string {
    return `# üöÄ Markdown Viewer –¥–ª—è 1–°

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ markdown —Ñ–∞–π–ª–æ–≤ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —è–∑—ã–∫–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.

### üìù –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏

- **JSON** - –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- **BSL/1C** - —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –æ–±–∞ –∞–ª–∏–∞—Å–∞)  
- **Gherkin** - –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
- **JavaScript, Python, SQL** - –∏ –¥—Ä—É–≥–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —è–∑—ã–∫–∏

### üíª –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

#### JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
\`\`\`json
{
    "name": "markdown-viewer",
    "version": "1.0.0",
    "dependencies": {
        "marked": "^12.0.0",
        "highlight.js": "^11.9.0"
    }
}
\`\`\`

#### BSL –∫–æ–¥ (1–°) - –∞–ª–∏–∞—Å bsl
\`\`\`bsl
–ü—Ä–æ—Ü–µ–¥—É—Ä–∞ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å–î–æ–∫—É–º–µ–Ω—Ç(–î–æ–∫—É–º–µ–Ω—Ç)
    
    –ï—Å–ª–∏ –î–æ–∫—É–º–µ–Ω—Ç.–ü—Ä–æ–≤–µ–¥–µ–Ω –¢–æ–≥–¥–∞
        –°–æ–æ–±—â–∏—Ç—å("–î–æ–∫—É–º–µ–Ω—Ç —É–∂–µ –ø—Ä–æ–≤–µ–¥–µ–Ω");
        –í–æ–∑–≤—Ä–∞—Ç;
    –ö–æ–Ω–µ—Ü–ï—Å–ª–∏;
    
    –ü–æ–ø—ã—Ç–∫–∞
        –î–æ–∫—É–º–µ–Ω—Ç.–ó–∞–ø–∏—Å–∞—Ç—å(–†–µ–∂–∏–º–ó–∞–ø–∏—Å–∏–î–æ–∫—É–º–µ–Ω—Ç–∞.–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ);
        –°–æ–æ–±—â–∏—Ç—å("–î–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–≤–µ–¥–µ–Ω");
    –ò—Å–∫–ª—é—á–µ–Ω–∏–µ
        –°–æ–æ–±—â–∏—Ç—å("–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞: " + –û–ø–∏—Å–∞–Ω–∏–µ–û—à–∏–±–∫–∏());
    –ö–æ–Ω–µ—Ü–ü–æ–ø—ã—Ç–∫–∏;
    
–ö–æ–Ω–µ—Ü–ü—Ä–æ—Ü–µ–¥—É—Ä—ã
\`\`\`

#### –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å (1c)
\`\`\`1c
–§—É–Ω–∫—Ü–∏—è –ü–æ–ª—É—á–∏—Ç—å–°—É–º–º—É–î–æ–∫—É–º–µ–Ω—Ç–∞(–î–æ–∫—É–º–µ–Ω—Ç)
    
    –ï—Å–ª–∏ –î–æ–∫—É–º–µ–Ω—Ç.–ü—É—Å—Ç–æ–π() –¢–æ–≥–¥–∞
        –í–æ–∑–≤—Ä–∞—Ç 0;
    –ö–æ–Ω–µ—Ü–ï—Å–ª–∏;
    
    –°—É–º–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞ = 0;
    –î–ª—è –ö–∞–∂–¥–æ–≥–æ –°—Ç—Ä–æ–∫–∞–î–æ–∫—É–º–µ–Ω—Ç–∞ –ò–∑ –î–æ–∫—É–º–µ–Ω—Ç.–¢–æ–≤–∞—Ä—ã –¶–∏–∫–ª
        –°—É–º–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞ = –°—É–º–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞ + –°—Ç—Ä–æ–∫–∞–î–æ–∫—É–º–µ–Ω—Ç–∞.–°—É–º–º–∞;
    –ö–æ–Ω–µ—Ü–¶–∏–∫–ª–∞;
    
    –í–æ–∑–≤—Ä–∞—Ç –°—É–º–º–∞–î–æ–∫—É–º–µ–Ω—Ç–∞;
    
–ö–æ–Ω–µ—Ü–§—É–Ω–∫—Ü–∏–∏
\`\`\`

#### Gherkin —Ç–µ—Å—Ç
\`\`\`gherkin
Feature: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
  Background:
    Given —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
    And –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω

  Scenario: –£—Å–ø–µ—à–Ω–æ–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    Given –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω
    When –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–æ–¥–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç
    Then –¥–æ–∫—É–º–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–æ–≤–µ–¥–µ–Ω
    And —Å—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å "–ü—Ä–æ–≤–µ–¥–µ–Ω"

  Scenario: –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞
    Given –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω
    And –¥–æ–∫—É–º–µ–Ω—Ç —É–∂–µ –ø—Ä–æ–≤–µ–¥–µ–Ω
    When –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç
    Then –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–∫–∞–∑–∞–Ω–∞ –æ—à–∏–±–∫–∞
    And –¥–æ–∫—É–º–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–º
\`\`\`

### üìä –¢–∞–±–ª–∏—Ü—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|-----------|----------|--------|
| –ü–∞—Ä—Å–µ—Ä Markdown | marked.js | ‚úÖ –ì–æ—Ç–æ–≤ |
| –ü–æ–¥—Å–≤–µ—Ç–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ | highlight.js | ‚úÖ –ì–æ—Ç–æ–≤ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ BSL | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ª–µ–∫—Å–µ—Ä highlight.js | ‚úÖ –ì–æ—Ç–æ–≤ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 1C | –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ª–µ–∫—Å–µ—Ä highlight.js | ‚úÖ –ì–æ—Ç–æ–≤ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Gherkin | –ö–∞—Å—Ç–æ–º–Ω—ã–π –ª–µ–∫—Å–µ—Ä | ‚úÖ –ì–æ—Ç–æ–≤ |
| –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º | CSS + JS | ‚úÖ –ì–æ—Ç–æ–≤ |

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

> **–í–∞–∂–Ω–æ:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª —Å –ø–æ–º–æ—â—å—é Vite –¥–ª—è —É–¥–æ–±–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ 1–°.

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π ES6+ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç drag & drop –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞** - –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª" –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª –≤ –æ–∫–Ω–æ
2. **–ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º** - –Ω–∞–∂–º–∏—Ç–µ F11 –∏–ª–∏ –∫–Ω–æ–ø–∫—É "–ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω"
3. **–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏**:
   - \`Ctrl+O\` - –æ—Ç–∫—Ä—ã—Ç—å —Ñ–∞–π–ª
   - \`F11\` - –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
   - \`Escape\` - –≤—ã–π—Ç–∏ –∏–∑ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ`;
}
